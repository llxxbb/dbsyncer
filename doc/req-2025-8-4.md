# dbsyncer 2025-8-4 需求

## 强需求

1. 数据同步到 kafka ，kafka接收不到消息(OK)

2. kafka 作为目标数据源时，需要支持一个主题对应源数据源的所有选择的数据表(OK)

3. 不支持全量加增量模式

4. 源表结构变更 目的地感知不到，需要增加选择项：变更或不变更

5. 异构数据库 ，目的地不能自动创建表结构

6. 需要增加数据清洗功能，源数据查出来 进行加列赋值后 同步到目的地，比如源表5个列 到目的地表变成6个列 ，增加一个webid。

7. 目的地需要适配tidb数据库

8. 数据库主备切换后 ，任务如何适配新的数据源自动进行完美衔接。

## 弱需求

1. 添加连接配置，用户体验差

2. 权限划分需要区分管理员和普通用户

3. 平台自身没有kafka来缓冲数据，性能问题 且非高可用架构。

## kafka

输出格式参考：

```json
{
  "dataSourceType": "SQL_SERVER",
  "SourceAddress": "10.81.0.235",
  "SourceDBName": "accjiaowu",
  "tableName": "ADVC_MEMBER_CLASS",
  "type": "DML",
  "subType": "UPDATE",
  "value": "{\"classID\":71850,\"userID\":41875715,\"studentNo\":\"2605447300311\",\"studyCourse\":\"13899\",\"sequence\":11,\"lastLogin\":null,\"firstTime\":\"2025-07-11 11:02:00.000000000\",\"createTime\":\"2025-07-28 15:41:00.000000000\",\"rightRate\":null,\"remarks\":null,\"status\":0,\"visitable\":0,\"oldUID\":null,\"updateTime\":\"2025-07-30 11:58:36.270000000\",\"maxCourseType\":1023,\"classesID\":143,\"suspension\":0,\"suspensionTime\":null,\"label\":null,\"studyEduSubject\":null,\"divideType\":0}",
  "eventTimestamp": 1753847944543,
  "collectTimestamp": 1753847944543,
  "primaryKeys": {
    "classID": 71850,
    "userID": 41875715
  }
}
```