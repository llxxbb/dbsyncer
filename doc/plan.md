# DBSyncer项目开发计划

## 1. 概述

本计划基于需求文档 req-2025-8-4.md 中列出的10个主要功能需求，对DBSyncer项目进行工作分解结构（WBS）分解和工时评估。

## 2. WBS分解与工时评估

### 2.1 需求1：数据同步到kafka，kafka接收不到消息

#### 问题诊断

- 分析Kafka连接器实现代码 (2小时)
- 检查Kafka消息发送逻辑 (3小时)
- 确认Kafka配置参数正确性 (2小时)

#### 问题修复

- 修复Kafka消息发送问题 (5小时)
- 增加错误日志记录 (2小时)
- 添加消息发送确认机制 (4小时)
- 测试验证修复效果 (3小时)

**小计：21小时**

### 2.2 需求2：不支持全量加增量模式

#### 设计全量+增量同步模式

- 定义全量+增量同步模式的工作流程 (5小时)
- 修改ModelEnum枚举，添加新的同步模式 (3小时)
- 设计全量和增量任务的协调机制 (6小时)

#### 实现全量+增量同步功能

- 修改UI界面，添加全量+增量选项 (4小时)
- 实现全量+增量同步的调度逻辑 (10小时)
- 实现任务状态管理和切换机制 (8小时)
- 测试全量+增量同步功能 (6小时)

**小计：42小时**

### 2.3 需求3：源表结构变更，目的地感知不到，需要增加选择项：变更或不变更

#### 表结构变更检测

- 实现表结构变更检测机制 (10小时)
- 添加表结构版本管理 (6小时)
- 设计变更通知机制 (4小时)

#### 变更处理选项

- 在UI中添加变更处理选项（变更/不变更） (4小时)
- 实现自动变更处理逻辑 (8小时)
- 实现忽略变更处理逻辑 (6小时)
- 测试表结构变更场景 (5小时)

**小计：43小时**

### 2.4 需求4：异构数据库，目的地不能自动创建表结构

#### 自动建表功能设计

- 设计异构数据库建表映射规则 (6小时)
- 实现表结构转换逻辑 (10小时)
- 添加建表选项到UI界面 (3小时)

#### 自动建表功能实现

- 实现各数据库类型的建表语句生成 (12小时)
- 添加建表权限检查 (3小时)
- 实现自动建表执行逻辑 (8小时)
- 测试异构数据库自动建表功能 (6小时)

**小计：48小时**

### 2.5 需求5：增加数据清洗功能

#### 数据清洗功能设计

- 设计数据清洗插件接口 (6小时)
- 实现列映射和转换规则 (8小时)
- 添加数据清洗配置UI (5小时)

#### 数据清洗功能实现

- 实现源数据列到目标数据列的映射 (10小时)
- 支持添加新列并赋值 (8小时)
- 实现数据转换逻辑 (10小时)
- 测试数据清洗功能（如源5列变目标6列） (6小时)

**小计：53小时**

### 2.6 需求6：目的地需要适配TiDB数据库

#### TiDB适配分析

- 研究TiDB与MySQL兼容性 (5小时)
- 分析现有MySQL连接器适配可能性 (4小时)

#### TiDB适配实现

- 修改MySQL连接器以支持TiDB (10小时)
- 或创建独立的TiDB连接器 (15小时)
- 测试TiDB连接和同步功能 (6小时)
- 更新文档和兼容性说明 (3小时)

**小计：43小时（按修改MySQL连接器计算）**

### 2.7 需求7：数据库主备切换后，任务如何适配新的数据源自动进行完美衔接

#### 主备切换检测

- 实现主备切换检测机制 (8小时)
- 添加连接状态监控 (5小时)

#### 自动切换实现

- 实现连接自动重试和切换逻辑 (12小时)
- 添加主备连接配置选项 (4小时)
- 实现任务恢复机制 (8小时)
- 测试主备切换场景 (6小时)

**小计：43小时**

### 2.8 需求8：添加连接配置，用户体验差

#### 用户体验分析

- 分析现有连接配置流程 (4小时)
- 收集用户反馈和痛点 (3小时)

#### 用户体验优化

- 优化连接配置界面 (8小时)
- 添加连接测试功能 (6小时)
- 增加配置向导和提示 (6小时)
- 实现配置模板功能 (5小时)

**小计：32小时**

### 2.9 需求9：权限划分需要区分管理员和普通用户

#### 权限模型设计

- 分析现有权限系统 (3小时)
- 设计管理员和普通用户权限模型 (5小时)
- 定义权限控制规则 (4小时)

#### 权限功能实现

- 实现基于角色的访问控制（RBAC） (10小时)
- 修改用户管理界面 (6小时)
- 添加权限验证逻辑 (8小时)
- 测试权限控制功能 (5小时)

**小计：41小时**

### 2.10 需求10：平台自身没有kafka来缓冲数据，性能问题且非高可用架构

#### 架构优化设计

- 设计基于Kafka的数据缓冲架构 (10小时)
- 实现高可用方案 (8小时)
- 评估性能提升方案 (5小时)

#### 架构优化实现

- 集成Kafka作为内部数据缓冲 (15小时)
- 实现数据缓冲和批量处理 (12小时)
- 添加高可用配置选项 (6小时)
- 性能测试和优化 (8小时)

**小计：64小时**

## 3. 总体工时评估

| 需求编号   | 需求描述                          | 工时(小时)  |
| ------ | ----------------------------- | ------- |
| 1      | 数据同步到kafka，kafka接收不到消息        | 21      |
| 2      | 不支持全量加增量模式                    | 42      |
| 3      | 源表结构变更，目的地感知不到，需要增加选择项：变更或不变更 | 43      |
| 4      | 异构数据库，目的地不能自动创建表结构            | 48      |
| 5      | 增加数据清洗功能                      | 53      |
| 6      | 目的地需要适配TiDB数据库                | 43      |
| 7      | 数据库主备切换后，任务如何适配新的数据源自动进行完美衔接  | 43      |
| 8      | 添加连接配置，用户体验差                  | 32      |
| 9      | 权限划分需要区分管理员和普通用户              | 41      |
| 10     | 平台自身没有kafka来缓冲数据，性能问题且非高可用架构  | 64      |
| **总计** |                               | **430** |

## 4. 项目资源规划

### 4.1 人力资源

- 核心开发人员：3人
- 测试人员：1人
- 项目经理：1人

### 4.2 时间规划

按照每周5个工作日，每天8小时计算：

- 总工时：430小时
- 3名开发人员并行工作：约18人日（约3.6周）
- 考虑测试和文档时间，项目总周期预计：6周

### 4.3 风险评估

1. **技术风险**：
   
   - TiDB适配可能需要额外时间
   - Kafka缓冲架构集成复杂度较高

2. **进度风险**：
   
   - 多任务并行可能产生依赖问题
   - 部分功能可能需要更多测试时间

3. **质量风险**：
   
   - 新增功能可能引入新的bug
   - 需要充分的回归测试

## 5. 里程碑计划

| 里程碑 | 时间  | 目标                           |
| --- | --- | ---------------------------- |
| M1  | 第1周 | 完成需求1、8，修复Kafka连接问题，优化连接配置体验 |
| M2  | 第2周 | 完成需求2、6，实现全量+增量同步模式，适配TiDB   |
| M3  | 第3周 | 完成需求3、7，实现表结构变更检测和主备切换功能     |
| M4  | 第4周 | 完成需求4、5，实现自动建表和数据清洗功能        |
| M5  | 第5周 | 完成需求9、10，实现权限控制和Kafka缓冲架构    |
| M6  | 第6周 | 系统测试、bug修复和文档完善              |

## 6. 交付物

1. 修复后的Kafka连接器
2. 支持全量+增量同步模式的系统
3. 表结构变更检测和处理功能
4. 异构数据库自动建表功能
5. 数据清洗插件机制
6. TiDB数据库适配
7. 数据库主备自动切换机制
8. 优化的连接配置界面
9. 基于角色的权限控制系统
10. 基于Kafka的数据缓冲架构
11. 完整的测试报告和用户文档