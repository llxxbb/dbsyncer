# DBSyncer项目开发计划

## 1. 概述

本计划基于需求文档 req-2025-8-4.md 中列出的强需求，对DBSyncer项目进行工作分解结构（WBS）分解和工时评估。

## 2. WBS分解与工时评估

### 2.1 需求1：数据同步到kafka，kafka接收不到消息（完成）

#### 问题诊断

- 分析Kafka连接器实现代码 (2小时)
- 检查Kafka消息发送逻辑 (3小时)
- 确认Kafka配置参数正确性 (2小时)

#### 问题修复

- 修复Kafka消息发送问题 (5小时)
- 增加错误日志记录 (2小时)
- 添加消息发送确认机制 (4小时)
- 测试验证修复效果 (3小时)

**小计：21小时**

### 2.2 需求2：kafka 作为目标数据源时，需要支持一个主题对应源数据源的所有选择的数据表（完成）

#### 功能分析与设计

- 分析现有Kafka连接器实现 (3小时)
- 设计一个主题对应多表的实现方案 (5小时)
- 定义数据格式和表标识规则 (4小时)

#### 功能实现

- 修改Kafka连接器以支持多表同步到一个主题 (10小时)
- 实现表名标识和数据格式化 (8小时)
- 添加配置选项到UI界面 (4小时)
- 测试多表同步到一个主题功能 (6小时)

**小计：40小时**

### 2.3 需求3：不支持全量加增量模式

#### 设计全量+增量同步模式

- 定义全量+增量同步模式的工作流程 (5小时)
- 修改ModelEnum枚举，添加新的同步模式 (3小时)
- 设计全量和增量任务的协调机制 (6小时)

#### 实现全量+增量同步功能

- 修改UI界面，添加全量+增量选项 (4小时)
- 实现全量+增量同步的调度逻辑 (10小时)
- 实现任务状态管理和切换机制 (8小时)
- 测试全量+增量同步功能 (6小时)

**小计：42小时**

### 2.4 需求4：源表结构变更，目的地感知不到，需要增加选择项：变更或不变更

#### 表结构变更检测

- 实现表结构变更检测机制 (10小时)
- 添加表结构版本管理 (6小时)
- 设计变更通知机制 (4小时)

#### 变更处理选项

- 在UI中添加变更处理选项（变更/不变更） (4小时)
- 实现自动变更处理逻辑 (8小时)
- 实现忽略变更处理逻辑 (6小时)
- 测试表结构变更场景 (5小时)

**小计：43小时**

### 2.5 需求5：异构数据库，目的地不能自动创建表结构

#### 自动建表功能设计

- 设计异构数据库建表映射规则 (6小时)
- 实现表结构转换逻辑 (10小时)
- 添加建表选项到UI界面 (3小时)

#### 自动建表功能实现

- 实现各数据库类型的建表语句生成 (12小时)
- 添加建表权限检查 (3小时)
- 实现自动建表执行逻辑 (8小时)
- 测试异构数据库自动建表功能 (6小时)

**小计：48小时**

### 2.6 需求6：增加数据清洗功能

#### 数据清洗功能设计

- 设计数据清洗插件接口 (6小时)
- 实现列映射和转换规则 (8小时)
- 添加数据清洗配置UI (5小时)

#### 数据清洗功能实现

- 实现源数据列到目标数据列的映射 (10小时)
- 支持添加新列并赋值 (8小时)
- 实现数据转换逻辑 (10小时)
- 测试数据清洗功能（如源5列变目标6列） (6小时)

**小计：53小时**

### 2.7 需求7：目的地需要适配TiDB数据库

#### TiDB适配分析

- 研究TiDB与MySQL兼容性 (5小时)
- 分析现有MySQL连接器适配可能性 (4小时)

#### TiDB适配实现

- 修改MySQL连接器以支持TiDB (10小时)
- 或创建独立的TiDB连接器 (15小时)
- 测试TiDB连接和同步功能 (6小时)
- 更新文档和兼容性说明 (3小时)

**小计：43小时（按修改MySQL连接器计算）**

### 2.8 需求8：数据库主备切换后，任务如何适配新的数据源自动进行完美衔接

#### 主备切换检测

- 实现主备切换检测机制 (8小时)
- 添加连接状态监控 (5小时)

#### 自动切换实现

- 实现连接自动重试和切换逻辑 (12小时)
- 添加主备连接配置选项 (4小时)
- 实现任务恢复机制 (8小时)
- 测试主备切换场景 (6小时)

**小计：43小时**

## 3. 总体工时评估

| 需求编号   | 需求描述                                   | 工时(小时)  |
| ------ | -------------------------------------- | ------- |
| 1      | 数据同步到kafka，kafka接收不到消息                 | 21      |
| 2      | kafka 作为目标数据源时，需要支持一个主题对应源数据源的所有选择的数据表 | 40      |
| 3      | 不支持全量加增量模式                             | 42      |
| 4      | 源表结构变更，目的地感知不到，需要增加选择项：变更或不变更          | 43      |
| 5      | 异构数据库，目的地不能自动创建表结构                     | 48      |
| 6      | 增加数据清洗功能                               | 53      |
| 7      | 目的地需要适配TiDB数据库                         | 43      |
| 8      | 数据库主备切换后，任务如何适配新的数据源自动进行完美衔接           | 43      |
| **总计** |                                        | **333** |

## 4. 项目资源规划

### 4.1 人力资源

- 核心开发人员：3人
- 测试人员：1人
- 项目经理：1人

### 4.2 时间规划

按照每周5个工作日，每天8小时计算：

- 总工时：333小时
- 3名开发人员并行工作：约14人日（约2.8周）
- 考虑测试和文档时间，项目总周期预计：5周

### 4.3 风险评估

1. **技术风险**：

    - TiDB适配可能需要额外时间
    - Kafka多表同步到一个主题的实现复杂度较高

2. **进度风险**：

    - 多任务并行可能产生依赖问题
    - 部分功能可能需要更多测试时间

3. **质量风险**：

    - 新增功能可能引入新的bug
    - 需要充分的回归测试

## 5. 里程碑计划

| 里程碑 | 时间  | 目标                              |
| --- | --- | ------------------------------- |
| M1  | 第1周 | 完成需求1、2，修复Kafka连接问题，实现Kafka多表同步 |
| M2  | 第2周 | 完成需求3、7，实现全量+增量同步模式，适配TiDB      |
| M3  | 第3周 | 完成需求4、8，实现表结构变更检测和主备切换功能        |
| M4  | 第4周 | 完成需求5、6，实现自动建表和数据清洗功能           |
| M5  | 第5周 | 系统测试、bug修复和文档完善                 |

## 6. 交付物

1. 修复后的Kafka连接器
2. 支持一个主题对应多表的Kafka同步功能
3. 支持全量+增量同步模式的系统
4. 表结构变更检测和处理功能
5. 异构数据库自动建表功能
6. 数据清洗插件机制
7. TiDB数据库适配
8. 数据库主备自动切换机制
9. 完整的测试报告和用户文档